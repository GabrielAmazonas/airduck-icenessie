{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.4", "generated_at": "2026-01-24T13:50:52.300807Z", "invocation_id": "6827f043-e207-4623-961a-732435913f98", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.178855Z", "completed_at": "2026-01-24T13:50:52.193616Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.195838Z", "completed_at": "2026-01-24T13:50:52.195851Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02869582176208496, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.source_not_null_bronze_raw_documents_content.aea0bd8ad8", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect content\nfrom \"iceberg\".\"bronze\".\"raw_documents\"\nwhere content is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.170932Z", "completed_at": "2026-01-24T13:50:52.194167Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.196588Z", "completed_at": "2026-01-24T13:50:52.196594Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.030529499053955078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.airduck_transforms.silver_documents", "compiled": true, "compiled_code": "\n\n/*\n * Silver Layer: Deduplicated and Cleaned Documents\n * ================================================\n * - Removes duplicate content via SHA256 hash\n * - Filters by content length\n * - Parses metadata from JSON string\n */\n\nWITH raw AS (\n    SELECT \n        id,\n        content,\n        source,\n        raw_metadata as metadata,\n        ingested_at,\n        -- Deduplication hash (case-insensitive, trimmed)\n        TO_HEX(SHA256(TO_UTF8(LOWER(TRIM(content))))) as content_hash\n    FROM \"iceberg\".\"bronze\".\"raw_documents\"\n    \n    WHERE ingested_at > (SELECT COALESCE(MAX(processed_at), TIMESTAMP '1970-01-01') FROM \"iceberg\".\"silver_silver\".\"silver_documents\")\n    \n),\n\ndeduplicated AS (\n    SELECT \n        *,\n        ROW_NUMBER() OVER (\n            PARTITION BY content_hash \n            ORDER BY ingested_at DESC\n        ) as rn\n    FROM raw\n)\n\nSELECT \n    id,\n    content,\n    content_hash,\n    source,\n    metadata,\n    CURRENT_TIMESTAMP as processed_at\nFROM deduplicated\nWHERE rn = 1\n  AND LENGTH(content) >= 50\n  AND LENGTH(content) <= 10000", "relation_name": "\"iceberg\".\"silver_silver\".\"silver_documents\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.188184Z", "completed_at": "2026-01-24T13:50:52.194950Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.197907Z", "completed_at": "2026-01-24T13:50:52.197912Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03029656410217285, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.source_not_null_bronze_raw_documents_id.0670700bf5", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"iceberg\".\"bronze\".\"raw_documents\"\nwhere id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.206236Z", "completed_at": "2026-01-24T13:50:52.222189Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.224901Z", "completed_at": "2026-01-24T13:50:52.224911Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.024837493896484375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.airduck_transforms.gold_documents", "compiled": true, "compiled_code": "\n\n/*\n * Gold Layer: Vector-Ready Documents\n * ===================================\n * - Chunks long documents into smaller pieces\n * - Computes quality scores for filtering\n * - Ready for embedding generation by DuckDB/FastAPI\n */\n\nWITH silver AS (\n    SELECT * FROM \"iceberg\".\"silver_silver\".\"silver_documents\"\n),\n\n-- Generate chunk indices for documents\nchunk_indices AS (\n    SELECT \n        id as original_id,\n        content,\n        source,\n        content_hash,\n        metadata,\n        processed_at,\n        CAST(CEIL(LENGTH(content) / 1000.0) AS INTEGER) as num_chunks\n    FROM silver\n    WHERE LENGTH(content) > 0\n),\n\n-- Expand into chunks (simplified chunking - production should use overlap)\nchunked AS (\n    SELECT \n        original_id || '-' || CAST(chunk_idx AS VARCHAR) as id,\n        CASE \n            WHEN num_chunks = 1 THEN content\n            ELSE SUBSTR(\n                content, \n                (chunk_idx - 1) * 1000 + 1, \n                1000\n            )\n        END as content,\n        chunk_idx as chunk_index,\n        num_chunks as total_chunks,\n        metadata,\n        source,\n        content_hash as original_content_hash,\n        processed_at\n    FROM chunk_indices\n    CROSS JOIN UNNEST(SEQUENCE(1, GREATEST(1, num_chunks))) AS t(chunk_idx)\n),\n\n-- Compute quality scores\nscored AS (\n    SELECT \n        *,\n        -- Quality score based on content characteristics (0.0 - 1.0)\n        (\n            -- Length score (0.0 - 0.3)\n            CASE \n                WHEN LENGTH(content) > 200 THEN 0.3\n                WHEN LENGTH(content) > 100 THEN 0.2\n                ELSE 0.1 \n            END +\n            -- Has proper case (0.0 - 0.2)\n            CASE WHEN REGEXP_LIKE(content, '[A-Z]') THEN 0.2 ELSE 0.0 END +\n            -- Word count (0.0 - 0.3)\n            CASE \n                WHEN CARDINALITY(SPLIT(content, ' ')) > 20 THEN 0.3\n                WHEN CARDINALITY(SPLIT(content, ' ')) > 10 THEN 0.2\n                ELSE 0.1 \n            END +\n            -- Not blank (0.0 - 0.2)\n            CASE WHEN NOT REGEXP_LIKE(content, '^\\s*$') THEN 0.2 ELSE 0.0 END\n        ) as quality_score\n    FROM chunked\n    WHERE LENGTH(TRIM(content)) > 0\n)\n\nSELECT \n    id,\n    content,\n    chunk_index,\n    total_chunks,\n    metadata,\n    source,\n    original_content_hash,\n    -- Embedding placeholder (computed by DuckDB/FastAPI later)\n    CAST(NULL AS ARRAY(REAL)) as embedding,\n    quality_score,\n    CURRENT_TIMESTAMP as ready_at\nFROM scored\nWHERE quality_score >= 0.5", "relation_name": "\"iceberg\".\"silver_gold\".\"gold_documents\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.209976Z", "completed_at": "2026-01-24T13:50:52.222643Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.226175Z", "completed_at": "2026-01-24T13:50:52.226183Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.025719642639160156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_silver_documents_content.3649e86479", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect content\nfrom \"iceberg\".\"silver_silver\".\"silver_documents\"\nwhere content is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.213748Z", "completed_at": "2026-01-24T13:50:52.223580Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.227455Z", "completed_at": "2026-01-24T13:50:52.227460Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0266263484954834, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_silver_documents_content_hash.3c28173e86", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect content_hash\nfrom \"iceberg\".\"silver_silver\".\"silver_documents\"\nwhere content_hash is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.218482Z", "completed_at": "2026-01-24T13:50:52.224174Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.227924Z", "completed_at": "2026-01-24T13:50:52.227929Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02677607536315918, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_silver_documents_id.9dc9aee5ec", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"iceberg\".\"silver_silver\".\"silver_documents\"\nwhere id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.235965Z", "completed_at": "2026-01-24T13:50:52.254483Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.256707Z", "completed_at": "2026-01-24T13:50:52.256718Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.026606321334838867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_silver_documents_processed_at.1b5086d7fd", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect processed_at\nfrom \"iceberg\".\"silver_silver\".\"silver_documents\"\nwhere processed_at is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.246422Z", "completed_at": "2026-01-24T13:50:52.255866Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.259436Z", "completed_at": "2026-01-24T13:50:52.259442Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.026955842971801758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_gold_documents_chunk_index.3d9f04eae4", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect chunk_index\nfrom \"iceberg\".\"silver_gold\".\"gold_documents\"\nwhere chunk_index is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.240313Z", "completed_at": "2026-01-24T13:50:52.256304Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.259827Z", "completed_at": "2026-01-24T13:50:52.259831Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02876758575439453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.unique_silver_documents_content_hash.75cf9eb00f", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    content_hash as unique_field,\n    count(*) as n_records\n\nfrom \"iceberg\".\"silver_silver\".\"silver_documents\"\nwhere content_hash is not null\ngroup by content_hash\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.251415Z", "completed_at": "2026-01-24T13:50:52.257185Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.260754Z", "completed_at": "2026-01-24T13:50:52.260759Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.028356552124023438, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_gold_documents_content.3f4a9b02a4", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect content\nfrom \"iceberg\".\"silver_gold\".\"gold_documents\"\nwhere content is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.266308Z", "completed_at": "2026-01-24T13:50:52.278428Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.283667Z", "completed_at": "2026-01-24T13:50:52.283678Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02284693717956543, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_gold_documents_id.2a9bd59688", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"iceberg\".\"silver_gold\".\"gold_documents\"\nwhere id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.271768Z", "completed_at": "2026-01-24T13:50:52.283148Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.286809Z", "completed_at": "2026-01-24T13:50:52.286815Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0236661434173584, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_gold_documents_quality_score.601b556ddc", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect quality_score\nfrom \"iceberg\".\"silver_gold\".\"gold_documents\"\nwhere quality_score is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.275125Z", "completed_at": "2026-01-24T13:50:52.284121Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.288152Z", "completed_at": "2026-01-24T13:50:52.288159Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.025217533111572266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_gold_documents_ready_at.195ae128fe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ready_at\nfrom \"iceberg\".\"silver_gold\".\"gold_documents\"\nwhere ready_at is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.278954Z", "completed_at": "2026-01-24T13:50:52.285882Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.290110Z", "completed_at": "2026-01-24T13:50:52.290117Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.022403717041015625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.not_null_gold_documents_total_chunks.cdea23d221", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect total_chunks\nfrom \"iceberg\".\"silver_gold\".\"gold_documents\"\nwhere total_chunks is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-24T13:50:52.292975Z", "completed_at": "2026-01-24T13:50:52.296687Z"}, {"name": "execute", "started_at": "2026-01-24T13:50:52.297450Z", "completed_at": "2026-01-24T13:50:52.297455Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008570671081542969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.airduck_transforms.unique_gold_documents_id.3ce821f85f", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"iceberg\".\"silver_gold\".\"gold_documents\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null}], "elapsed_time": 0.24497175216674805, "args": {"macro_debugging": false, "send_anonymous_usage_stats": true, "static_parser": true, "profiles_dir": "/opt/airflow/dbt", "log_level_file": "debug", "target": "dev", "invocation_command": "dbt docs generate --profiles-dir /opt/airflow/dbt --target dev", "introspect": true, "write_json": true, "print": true, "populate_cache": true, "show_resource_report": false, "warn_error_options": {"include": [], "exclude": []}, "log_format_file": "debug", "empty_catalog": false, "project_dir": "/opt/airflow/dbt", "quiet": false, "which": "generate", "partial_parse_file_diff": true, "log_level": "info", "defer": false, "printer_width": 80, "static": false, "log_path": "/opt/airflow/dbt/logs", "vars": {}, "exclude": [], "log_format": "default", "favor_state": false, "enable_legacy_logger": false, "compile": true, "cache_selected_only": false, "use_colors_file": true, "log_file_max_bytes": 10485760, "partial_parse": true, "strict_mode": false, "version_check": true, "select": [], "indirect_selection": "eager", "use_colors": true}}